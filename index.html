<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jardim da J√∫lia ‚Äî jogo de autocuidado gentil</title>
  <meta name="description" content="P√°gina gamificada, suave e acolhedora, para apoiar a J√∫lia em microtarefas de autocuidado com refor√ßo positivo, respira√ß√£o, grounding, ativa√ß√£o comportamental e mensagens compassivas." />
  <meta name="theme-color" content="#F0F7F4" />
  <style>
    :root{
      --bg:#F7FAF9;          /* fundo calmo */
      --card:#FFFFFF;        /* cart√µes */
      --ink:#1B2A2F;         /* texto principal */
      --muted:#5C6B70;       /* texto secund√°rio */
      --accent:#6BC3B1;      /* destaque suave (verde √°gua) */
      --accent-2:#8EC5FF;    /* destaque secund√°rio (azul suave) */
      --warn:#FFB4B4;        /* alerta suave */
      --ok:#A1E3A1;          /* sucesso suave */
      --shadow: 0 4px 18px rgba(0,0,0,.08);
      --radius: 16px;

      /* Bot√µes sim√©tricos */
      --btn-h: 44px;
      --btn-min: 140px;

      /* Cores do bal√£o de respira√ß√£o (calmas e contrastantes) */
      --breath-center:#FFFFFF;
      --breath-ring:#CFEAFC;     /* azul bem calmo */
      --breath-outline:#8ABFEF;  /* contraste suave */
    }

    /* Tema Noturno (ativado via classe .dark no body) */
    body.dark{
      --bg:#0F1517;
      --card:#121C20;
      --ink:#E6F1F0;
      --muted:#9CB3B2;
      --accent:#5DB9A6;
      --accent-2:#78B4FF;
      --warn:#FF9E9E;
      --ok:#7BD47B;

      --breath-center:#162229;
      --breath-ring:#265C80;
      --breath-outline:#7FBDF0;
    }

    *{box-sizing:border-box}
    html,body{margin:0; padding:0; background:var(--bg); color:var(--ink); font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}

    /* Textos justificados de forma global (mant√©m centraliza√ß√µes pontuais por inline style) */
    p, li { text-align: justify; }

    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; padding:12px 0 6px 0;}
    .brand{display:flex; align-items:center; gap:12px}
    .brand h1{font-size: clamp(20px, 2.4vw, 28px); margin:0}
    .brand small{display:block; color:var(--muted); font-size:12px}

    /* Toolbar sim√©trica */
    .toolbar{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap}
    .pill{display:inline-flex; align-items:center; justify-content:center; gap:6px; background:#EAF6F3; padding:0 12px; border-radius:999px; font-weight:600; height:var(--btn-h); min-width:var(--btn-min)}
    body.dark .pill{background:#1B2A2F}

    /* Bot√µes com dimens√µes e alinhamento iguais */
    button, .btn, .btn-ghost, .btn-secondary, .btn-warn, .btn-ok{
      display:inline-flex; align-items:center; justify-content:center;
      height:var(--btn-h); min-width:var(--btn-min); padding:0 16px;
      border:0; border-radius:12px; box-shadow:var(--shadow);
      cursor:pointer; font-weight:700; letter-spacing:.25px;
    }
    .btn{background:var(--accent); color:#073B3A}
    .btn-secondary{background:var(--accent-2); color:#0A2C57}
    .btn-ghost{background:#E9F4F1; color:#074743}
    body.dark .btn-ghost{background:#1B2A2F; color:#CFE7E4}
    .btn-warn{background:var(--warn); color:#5A0101}
    .btn-ok{background:var(--ok); color:#053305}

    .icon{width:26px; height:26px; display:inline-block; vertical-align:middle}

    /* Cart√µes com alturas consistentes; bot√µes no rodap√© do cart√£o */
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:14px;}
    .card{background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:8px}
    .card h3{margin:6px 0 8px 0; font-size:18px}
    .card p{margin:4px 0; color:var(--muted)}
    .grid .card .btn{width:100%; margin-top:auto}

    .plant-area{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width:920px){ 
      .plant-area{grid-template-columns:1fr}
      header{justify-content:center}
      .brand{justify-content:center}
    }

    .meter{height:10px; background:#E6F1EF; border-radius:999px; overflow:hidden;}
    .meter>div{height:100%; background:linear-gradient(90deg, var(--accent), var(--accent-2)); width:0%; transition: width .6s ease}
    .section-title{display:flex; align-items:center; justify-content:space-between; margin:18px 0 8px 0}
    .subtle{color:var(--muted); font-size:14px}

    /* Modal */
    dialog{border:0; border-radius:18px; padding:0; width:min(680px, 96vw); box-shadow:var(--shadow)}
    dialog::backdrop{background:rgba(0,0,0,.2)}
    .modal{background:var(--card); border-radius:18px; overflow:hidden}
    .modal header{padding:16px; border-bottom:1px solid #EEF3F2}
    body.dark .modal header{border-bottom-color:#1E2A2E}
    .modal section{padding:18px}

    .timer{display:flex; flex-direction:column; align-items:center; gap:10px}
    .timer .time{font-weight:800; font-size:44px; letter-spacing:1px}
    .progress{height:12px; width:100%; background:#E9F4F1; border-radius:999px; overflow:hidden}
    .progress>div{height:100%; width:0%; background:linear-gradient(90deg, var(--accent-2), var(--accent)); transition: width .3s linear}
    /* Bot√µes do modal alinhados e sim√©tricos */
    .timer .actions{display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; justify-content:center; width:100%}
    .timer .actions button{flex:1 1 140px}

    /* Bal√£o de Respira√ß√£o (contraste calmo + expans√£o maior/menor) */
    .breath{
      width: 240px; height: 240px; border-radius:50%;
      background: radial-gradient(circle at 50% 50%, var(--breath-center) 0, var(--breath-center) 38%, var(--breath-ring) 100%);
      box-shadow: 0 0 0 3px var(--breath-outline) inset, var(--shadow);
      display:grid; place-items:center; margin: 10px auto;
      animation: pulse 8s ease-in-out infinite;
    }
    @keyframes pulse{
      0%   { transform: scale(0.92);   filter: saturate(0.95); }
      50%  { transform: scale(1.12);   filter: saturate(1.05); }
      100% { transform: scale(0.92);   filter: saturate(0.95); }
    }

    .affirm{background:linear-gradient(180deg,#FEFFFF,#F3FBF9); padding:12px; border-radius:14px; border:1px dashed #D8EEE9}
    body.dark .affirm{background:linear-gradient(180deg,#132028,#1A2E37); border-color:#23414A}

    .badge{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:#F0F7FF; color:#0F345C; font-weight:700}
    .badges{display:flex; gap:8px; flex-wrap:wrap}

    /* GARDEN */
    .garden{width:100%; height:300px; position:relative; border-radius:14px; overflow:hidden; background:linear-gradient(180deg,#F4FBF9 0%, #FFFFFF 50%, #EAF6F3 100%);} 
    body.dark .garden{background:linear-gradient(180deg,#0F1B1E 0%, #0F1A1D 50%, #0F2226 100%);}
    .garden::after{content:""; position:absolute; inset:auto 0 0 0; height:46px; background:linear-gradient(180deg,#D6EFE7,#C7E9DF);}
    body.dark .garden::after{background:linear-gradient(180deg,#13282E,#103038);}
    .flower{position:absolute; width:28px; height:28px; transform: translate(-50%,-50%) scale(.6); animation: pop .35s ease-out;}
    @keyframes pop{from{transform: translate(-50%,-50%) scale(.2); opacity:0} to{transform: translate(-50%,-50%) scale(.6); opacity:1}}
    .sky-bubbles{position:absolute; inset:0; opacity:.25; pointer-events:none}
    .bubble{position:absolute; bottom:-30px; width:10px; height:10px; background:#8EC5FF; border-radius:50%; animation: rise 12s linear infinite}
    @keyframes rise{ to{ transform: translateY(-120vh)} }

    .footer{margin:24px 0; color:var(--muted); font-size:13px; text-align:center}
    .signature{margin-top:6px; font-weight:700; color:var(--ink)}
    .kbd{border:1px solid #d8e7e3; padding:2px 6px; border-radius:6px; background:#f6fbfa}
    body.dark .kbd{border-color:#244148; background:#14262B; color:#CDE3E0}

    /* Justificar conte√∫do do bloco ‚ÄúSobre o medo de mudar‚Äù (j√° estava, mantido) */
    .justify{ text-align: justify; }
    .justify li{ text-align: justify; }
  </style>
</head>
<body>
  <div class="wrap">
    <header aria-label="Barra superior">
      <div class="brand" role="banner" aria-label="Jardim da J√∫lia">
        <span aria-hidden="true" class="icon">üåø</span>
        <div>
          <h1>Jardim da J√∫lia</h1>
          <small>Um jogo de autocuidado gentil üå±</small>
        </div>
      </div>
      <div class="toolbar" role="toolbar" aria-label="Controles">
        <span class="pill" title="Seu progresso hoje"><span aria-hidden>‚≠ê</span> <span id="stars">0</span> pontos</span>
        <span class="pill" title="Flores plantadas">üåº <span id="flowerCount">0</span></span>
        <button id="muteBtn" class="btn-ghost" aria-pressed="false" aria-label="Alternar sons">üîà Som</button>
        <button id="nightBtn" class="btn-secondary" aria-pressed="false" aria-label="Ativar/Desativar Modo Noturno">üåô Modo Noturno: OFF</button>
        <a class="btn-warn" id="cvvBtn" href="tel:188" aria-label="Precisa de ajuda agora? Ligar 188 do CVV">
          ‚ù§Ô∏è‚Äçü©π Precisa de ajuda agora? LIGAR 188 (CVV)
        </a>
      </div>
    </header>

    <main>
      <section class="card plant-area" aria-labelledby="plant-title">
        <div>
          <div class="section-title">
            <h2 id="plant-title" style="margin:0">Seu jardim hoje</h2>
            <span class="subtle">Cada microa√ß√£o planta uma flor. Visualize seu progresso üåº</span>
          </div>
          <div class="garden" id="garden" aria-live="polite" aria-label="Jardim. Cada flor representa uma miss√£o conclu√≠da.">
            <div class="sky-bubbles" id="bubbles" aria-hidden="true"></div>
          </div>
          <div class="meter" aria-label="Meta do dia">
            <div id="meterFill" style="width:0%"></div>
          </div>
          <p class="subtle" style="margin-top:6px">Meta suave: 5 pontos hoje. Cada miss√£o conclu√≠da planta uma flor. üíö</p>
        </div>

        <div>
          <div class="section-title">
            <h2 style="margin:0">Respirar e acalmar</h2>
            <span class="subtle">Use quando bater ansiedade</span>
          </div>
          <div class="card" aria-label="Exerc√≠cio de respira√ß√£o box">
            <div class="breath" id="breathCircle" aria-hidden="true"></div>
            <div style="text-align:center">
              <p id="breathCue" style="margin:6px 0; font-weight:700; text-align:center">Inspire (4)</p>
              <button class="btn-ghost" id="breathStart">‚ñ∂Ô∏è Iniciar respira√ß√£o 4‚Äì4‚Äì4‚Äì4</button>
            </div>
          </div>

          <div class="card" aria-label="Grounding 5-4-3-2-1">
            <h3>Grounding 5‚Äì4‚Äì3‚Äì2‚Äì1</h3>
            <p class="subtle">Olhe ao redor e diga:</p>
            <ul>
              <li>5 coisas que voc√™ v√™</li>
              <li>4 coisas que voc√™ sente com o corpo</li>
              <li>3 sons que voc√™ escuta</li>
              <li>2 cheiros que percebe</li>
              <li>1 gosto que sente</li>
            </ul>
            <button class="btn-ghost" id="groundBtn">‚ú® Registrar como feito (1 ponto)</button>
          </div>

          <div class="affirm" aria-label="Palavras suaves">
            <p id="affirmText" style="margin:0; font-weight:600; text-align:justify">Pequenos passos contam. Voc√™ n√£o precisa sentir vontade para come√ßar; a vontade aparece depois do primeiro passo.</p>
          </div>
        </div>
      </section>

      <section style="margin-top:16px">
        <div class="section-title">
          <h2 style="margin:0">Miss√µes de autocuidado (ativa√ß√£o comportamental)</h2>
          <span class="subtle">Escolha 1 miss√£o. Depois, se quiser, mais uma. Sem pressa.</span>
        </div>

        <div class="grid" role="list" aria-label="Lista de miss√µes">
          <!-- Higiene & cuidados essenciais -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">ü™• Escovar dentes</div>
            <h3>Brilho r√°pido ‚Äî 60s</h3>
            <p>30s acima + 30s abaixo. Gentileza &gt; perfei√ß√£o.</p>
            <button class="btn" data-mission="dentes">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üíá‚Äç‚ôÄÔ∏è Pentear</div>
            <h3>3 passes gentis ‚Äî 60s</h3>
            <p>Penteie devagar, tr√™s passes por regi√£o. Cuide de voc√™ como de uma amiga.</p>
            <button class="btn" data-mission="cabelo">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üöø Banho</div>
            <h3>Banho essencial ‚Äî 2 min</h3>
            <p>√Åreas essenciais, √°gua morna e respira√ß√£o calma.</p>
            <button class="btn" data-mission="banho">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üñêÔ∏è M√£os</div>
            <h3>Lavar as m√£os ‚Äî 30s</h3>
            <p>√Ågua, sab√£o e carinho ‚Äî palma, dorso, entre os dedos.</p>
            <button class="btn" data-mission="maos">Come√ßar miss√£o</button>
          </article>

          <!-- Ambiente -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üß∫ Quarto</div>
            <h3>Arruma√ß√£o turbo ‚Äî 3 min</h3>
            <p>Roupas no cesto e travesseiro alinhado. O b√°sico j√° muda o clima.</p>
            <button class="btn" data-mission="quarto">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">ü™ü Janela</div>
            <h3>Abrir + 5 respira√ß√µes ‚Äî 1 min</h3>
            <p>Abra a janela, sinta o ar e fa√ßa 5 respira√ß√µes lentas.</p>
            <button class="btn" data-mission="janela">Come√ßar miss√£o</button>
          </article>

          <!-- Corpo & energia -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">‚òÄÔ∏è Sol</div>
            <h3>Sol na janela ‚Äî 2 min</h3>
            <p>Luz suave no rosto ou nos bra√ßos. Seguran√ßa em primeiro lugar.</p>
            <button class="btn" data-mission="sol">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üßò Alongar</div>
            <h3>Alongamento suave ‚Äî 1 min</h3>
            <p>Pesco√ßo, ombros e bra√ßos. Movimento sem dor.</p>
            <button class="btn" data-mission="alongar">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üö∂ Passos</div>
            <h3>30 passos no quarto ‚Äî 60s</h3>
            <p>Caminhe devagar, conte at√© 30. Respire junto dos passos.</p>
            <button class="btn" data-mission="passos">Come√ßar miss√£o</button>
          </article>

          <!-- Hidratar & nutri√ß√£o simples -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üíß Hidratar</div>
            <h3>Copo d‚Äô√°gua ‚Äî agora</h3>
            <p>Encha um copo e beba devagar, observando a sensa√ß√£o.</p>
            <button class="btn" data-mission="agua">Concluir (instant√¢neo)</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">ü•™ Lanche</div>
            <h3>Lanche simples ‚Äî 2 min</h3>
            <p>1 fruta ou p√£o com algo leve. S√≥ o suficiente.</p>
            <button class="btn" data-mission="lanche">Come√ßar miss√£o</button>
          </article>

          <!-- Conex√£o & prazer -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üéµ M√∫sica</div>
            <h3>M√∫sica favorita ‚Äî 90s</h3>
            <p>Ou√ßa 90s de uma faixa que te faz bem.</p>
            <button class="btn" data-mission="musica">Come√ßar miss√£o</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üí¨ Contato</div>
            <h3>Enviar um emoji ‚Äî agora</h3>
            <p>Mande um üëç ou üåø para algu√©m de confian√ßa.</p>
            <button class="btn" data-mission="contato">Concluir (instant√¢neo)</button>
          </article>
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">üìù Registro</div>
            <h3>Uma coisa que valeu ‚Äî 1 min</h3>
            <p>Escreva uma linha sobre algo pequeno que valeu hoje.</p>
            <button class="btn" data-mission="registro">Come√ßar miss√£o</button>
          </article>

          <!-- Autocompaix√£o -->
          <article class="card" role="listitem">
            <div class="badge" aria-hidden="true">ü§ç Autocompaix√£o</div>
            <h3>Mensagem que abra√ßa ‚Äî 1 min</h3>
            <p>Leia: ‚ÄúEstou fazendo o melhor que consigo hoje. Eu mere√ßo cuidados gentis‚Äù.</p>
            <button class="btn" data-mission="compaixao">Come√ßar miss√£o</button>
          </article>
        </div>
      </section>

      <section style="margin-top:16px">
        <div class="section-title">
          <h2 style="margin:0">Sobre o medo de mudar</h2>
        </div>
        <div class="card justify">
          <p><strong>Ideia-chave:</strong> melhorar n√£o significa ser abandonada. Seu valor n√£o depende do que voc√™ faz hoje. As pessoas que importam querem voc√™ <em>viva e menos sobrecarregada</em>, um passo de cada vez.</p>
          <ul>
            <li><strong>Experimento gentil:</strong> fa√ßa 1 microa√ß√£o e observe: algu√©m deixa de gostar de voc√™ por isso? Registre a evid√™ncia.</li>
            <li><strong>Contrato consigo:</strong> ‚ÄúSe eu der pequenos passos por 7 dias, vou me dar um presente simples (m√∫sica, banho cheiroso, 10 min de sol).‚Äù</li>
            <li><strong>Frase-√¢ncora:</strong> ‚ÄúEu posso melhorar sem me perder. Eu sigo comigo.‚Äù</li>
          </ul>
        </div>
      </section>

      <section style="margin-top:16px">
        <div class="section-title">
          <h2 style="margin:0">Conquistas</h2>
          <span class="subtle">Selos por presen√ßa, n√£o por perfei√ß√£o</span>
        </div>
        <div class="card badges" id="badges" aria-live="polite"></div>
      </section>

      <p class="footer">
        Este jogo √© um apoio terap√™utico e <strong>n√£o substitui</strong> acompanhamento profissional. Em crise, toque em <strong id="cvvCtaInline">‚ÄúLIGAR 188 (CVV)‚Äù</strong> acima para falar com algu√©m agora. Seus dados ficam apenas no seu dispositivo (localStorage). ‚Äî v1.3
        <br />
        <span class="signature">Richelmy Murta, Psic√≥logo Clinico especialista em Terapia cognitivo comportamental.</span>
      </p>
    </main>
  </div>

  <!-- Modal de miss√£o -->
  <dialog id="missionModal" aria-labelledby="missionTitle">
    <div class="modal">
      <header>
        <h3 id="missionTitle" style="margin:0">Miss√£o</h3>
      </header>
      <section>
        <div id="missionDesc" class="subtle" style="margin-bottom:10px"></div>
        <div class="timer" aria-live="polite">
          <div class="time" id="time">00:00</div>
          <div class="progress"><div id="bar"></div></div>
          <div id="stepText" style="font-weight:700; text-align:center"></div>
          <div class="actions">
            <button id="startBtn" class="btn-ok">‚ñ∂Ô∏è Iniciar</button>
            <button id="pauseBtn" class="btn-ghost">‚è∏Ô∏è Pausar</button>
            <button id="finishBtn" class="btn">‚úÖ Concluir</button>
            <button id="closeBtn" class="btn-warn">‚úñÔ∏è Fechar</button>
          </div>
        </div>
        <details style="margin-top:10px">
          <summary><strong>Dicas compassivas</strong></summary>
          <ul>
            <li>N√£o precisa de perfei√ß√£o; s√≥ presen√ßa.</li>
            <li>Se cansar, pause. Voltar j√° √© vit√≥ria.</li>
            <li>Fale consigo como falaria com uma amiga querida.</li>
          </ul>
        </details>
      </section>
    </div>
  </dialog>

  <script>
    // ========= Estado =========
    const state = {
      stars: 0,
      muted: false,
      night: false,   // substitui "safe"
      badges: new Set(),
      doneToday: {},
      flowers: [], // {xPerc,yPerc,color}
    };

    // ========= Utilidades =========
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // Persist√™ncia simples
    const save = () => {
      try {
        localStorage.setItem('jardim-julia', JSON.stringify({
          stars: state.stars,
          badges: [...state.badges],
          doneToday: state.doneToday,
          flowers: state.flowers,
          night: state.night,
        }));
      } catch(e){}
    };
    const load = () => {
      try {
        const d = JSON.parse(localStorage.getItem('jardim-julia'))||{};
        state.stars = d.stars||0;
        state.badges = new Set(d.badges||[]);
        state.doneToday = d.doneToday||{};
        state.flowers = d.flowers||[];
        state.night = !!d.night;
        if(state.night) document.body.classList.add('dark');
      } catch(e){}
    };

    // ========= √Åudio =========
    let audioCtx, masterGain;
    function ensureAudio(){
      try{
        if(!audioCtx){
          audioCtx = new (window.AudioContext||window.webkitAudioContext)();
          masterGain = audioCtx.createGain();
          masterGain.gain.value = 0.6; // volume global
          masterGain.connect(audioCtx.destination);
        } else if(audioCtx.state === 'suspended'){ audioCtx.resume(); }
      }catch(e){}
    }

    function tone(freq=660, dur=0.09, type='square', vol=0.15){
      if(state.muted) return;
      ensureAudio(); if(!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value=freq;
      g.gain.value = 0.0001;
      o.connect(g).connect(masterGain);
      o.start();
      const now = audioCtx.currentTime;
      g.gain.exponentialRampToValueAtTime(vol, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.00001, now + dur);
      o.stop(now + dur + 0.02);
    }

    function tick(){ tone(900, 0.06, 'square', 0.18); }

    // Avisos suaves
    const affirmations = [
      'Pequenos passos contam. Voc√™ √© importante.',
      'Gentileza consigo mesma √© for√ßa, n√£o fraqueza.',
      'Voc√™ pode pausar e recome√ßar. Isso tamb√©m √© cuidado.',
      'Hoje, 1%. Amanh√£, quem sabe 1% de novo.',
      'Voc√™ n√£o est√° sozinha. Este passo j√° √© coragem.',
      'Melhorar n√£o significa perder; significa se acolher.',
    ];
    function setAffirm(){ $('#affirmText').textContent = affirmations[Math.floor(Math.random()*affirmations.length)]; }

    // ========= Jardim =========
    const COLORS = ['#FFDF7D','#FFD1E1','#D9C4FF','#BFF2D6','#FFE9A8','#FFC6A8'];

    function renderGarden(){
      const g = $('#garden');
      g.querySelectorAll('.flower').forEach(el=>el.remove());
      state.flowers.forEach(f=>{
        const el = document.createElement('div');
        el.className = 'flower';
        el.style.left = f.xPerc + '%';
        el.style.top = f.yPerc + '%';
        el.innerHTML = `<svg viewBox="0 0 24 24" width="28" height="28" aria-label="Flor"><g>
          <circle cx="12" cy="12" r="10" fill="${f.color}" stroke="#F6C453" stroke-width="2"/>
          <circle cx="12" cy="12" r="4" fill="#F6A800"/>
        </g></svg>`;
        g.appendChild(el);
      });
      $('#flowerCount').textContent = state.flowers.length;
    }

    function addFlower(){
      const g = $('#garden');
      const rect = g.getBoundingClientRect();
      const margin = 8;
      const x = margin + Math.random()*(rect.width - margin*2);
      const y = margin + Math.random()*(rect.height - margin*2);
      const f = {xPerc: (x/rect.width*100), yPerc: (y/rect.height*100), color: COLORS[Math.floor(Math.random()*COLORS.length)]};
      state.flowers.push(f);
      save(); renderGarden();
    }

    function renderBubbles(){
      const c = $('#bubbles'); c.innerHTML='';
      for(let i=0;i<8;i++){
        const b = document.createElement('div');
        b.className='bubble';
        b.style.left = Math.random()*100 + '%';
        b.style.animationDelay = (Math.random()*10)+'s';
        b.style.opacity = 0.2 + Math.random()*0.4;
        c.appendChild(b);
      }
    }

    function updateUI(){
      $('#stars').textContent = state.stars;
      const pct = Math.min(100, (state.stars/5)*100);
      $('#meterFill').style.width = pct+'%';
      setAffirm();
      renderBadges();
      renderGarden();
      renderBubbles();
      // Atualiza bot√µes
      $('#nightBtn').textContent = state.night ? 'üåô Modo Noturno: ON' : 'üåô Modo Noturno: OFF';
      $('#nightBtn').setAttribute('aria-pressed', String(state.night));
      $('#muteBtn').textContent = state.muted? 'üîá Sem som' : 'üîà Som';
      $('#muteBtn').setAttribute('aria-pressed', String(state.muted));
      save();
    }

    function addStars(n){
      state.stars = Math.max(0, state.stars + n);
      if(state.stars>=1) state.badges.add('Primeiro passo');
      if(state.stars>=3) state.badges.add('Regador Gentil');
      if(state.stars>=5) state.badges.add('Meta do Dia üíö');
      updateUI();
    }

    function renderBadges(){
      const box = $('#badges');
      box.innerHTML = [...state.badges].map(b=>`<span class="badge">üèÖ ${b}</span>`).join('');
    }

    // ========= Respira√ß√£o =========
    let breathTimer, breathPhase=0, breathCount=0; // 0 in, 1 hold, 2 out, 3 hold
    function nextBreathPhase(){
      const cues = ['Inspire (4)','Segure (4)','Expire (4)','Segure (4)'];
      $('#breathCue').textContent = cues[breathPhase];
      breathPhase = (breathPhase+1)%4; breathCount++;
      if(breathCount%4===0){ setAffirm(); tone(520,.12,'sine',0.1) }
    }
    $('#breathStart').addEventListener('click', ()=>{
      ensureAudio();
      clearInterval(breathTimer); breathPhase=0; breathCount=0; nextBreathPhase();
      breathTimer = setInterval(nextBreathPhase, 4000);
    });

    // ========= Grounding =========
    $('#groundBtn').addEventListener('click',()=>{ ensureAudio(); addStars(1); tone(660,.1) });

    // ========= Miss√µes =========
    const missions = {
      // Higiene
      dentes: { title:'Escovar dentes ‚Äî 60s', points:2, desc:'30s arcada de cima, 30s arcada de baixo. Gentileza > perfei√ß√£o.', steps:[{label:'Parte de cima (30s)',secs:30},{label:'Parte de baixo (30s)',secs:30}]},
      cabelo: { title:'Pentear ‚Äî 60s', points:1, desc:'Tr√™s passes por regi√£o, movimento lento e gentil.', steps:[{label:'Topo e laterais (30s)',secs:30},{label:'Nuca e comprimento (30s)',secs:30}]},
      banho:  { title:'Banho essencial ‚Äî 2min', points:2, desc:'√Åreas essenciais, √°gua morna e respira√ß√£o calma.', steps:[{label:'Pesco√ßo e axilas (40s)',secs:40},{label:'Partes √≠ntimas (40s)',secs:40},{label:'P√©s e enx√°gue (40s)',secs:40}]},
      maos:   { title:'Lavar as m√£os ‚Äî 30s', points:1, desc:'Palmas, dorso e entre os dedos.', steps:[{label:'Lavar gentilmente (30s)',secs:30}]},

      // Ambiente
      quarto: { title:'Arruma√ß√£o turbo ‚Äî 3min', points:2, desc:'Roupas no cesto e travesseiro alinhado. O b√°sico j√° ajuda.', steps:[{label:'Juntar roupas (60s)',secs:60},{label:'Cama e travesseiro (60s)',secs:60},{label:'Lixo leve / mesa (60s)',secs:60}]},
      janela: { title:'Abrir janela + 5 respira√ß√µes ‚Äî 1min', points:1, desc:'Abra a janela e fa√ßa 5 respira√ß√µes lentas.', steps:[{label:'Respirar com a janela aberta (60s)',secs:60}]},

      // Corpo & energia
      sol:    { title:'Sol na janela ‚Äî 2min', points:2, desc:'Luz suave no rosto/bra√ßos (se seguro).', steps:[{label:'Aproveitar a luz (60s)',secs:60},{label:'Perceber o corpo (60s)',secs:60}]},
      alongar:{ title:'Alongamento suave ‚Äî 1min', points:1, desc:'Pesco√ßo, ombros e bra√ßos.', steps:[{label:'Alongar com gentileza (60s)',secs:60}]},
      passos: { title:'30 passos ‚Äî 60s', points:1, desc:'Caminhe devagar e conte at√© 30.', steps:[{label:'Passos presentes (60s)',secs:60}]},

      // Hidratar & nutri√ß√£o
      agua:   { title:'Beber √°gua ‚Äî instant√¢neo', points:1, desc:'Encha um copo e beba devagar.', steps:[{label:'Beber √°gua',secs:5}]},
      lanche: { title:'Lanche simples ‚Äî 2min', points:2, desc:'1 fruta ou p√£o com algo leve.', steps:[{label:'Separar/Preparar (60s)',secs:60},{label:'Comer devagar (60s)',secs:60}]},

      // Conex√£o & prazer
      musica: { title:'M√∫sica favorita ‚Äî 90s', points:1, desc:'Ou√ßa 90s de algo que te faz bem.', steps:[{label:'Ouvir presente (90s)',secs:90}]},
      contato:{ title:'Enviar um emoji ‚Äî instant√¢neo', points:1, desc:'Mande um üëç ou üåø para algu√©m de confian√ßa.', steps:[{label:'Enviar agora',secs:5}]},
      registro:{title:'Uma coisa que valeu ‚Äî 1min', points:1, desc:'Escreva 1 linha sobre algo que valeu hoje.', steps:[{label:'Escrever (60s)',secs:60}]},

      // Autocompaix√£o
      compaixao:{title:'Autocompaix√£o ‚Äî 1min', points:1, desc:'‚ÄúEstou fazendo o melhor que consigo hoje. Eu mere√ßo cuidados gentis‚Äù.', steps:[{label:'Respire e leia a frase (60s)',secs:60}]}
    };

    let currentMission = null, stepIdx=0, stepRemain=0, totalSecs=0, elapsed=0, timerInt;

    function openMission(key){
      const m = missions[key]; if(!m) return;
      currentMission = key; stepIdx=0; stepRemain=m.steps[0].secs; elapsed=0; totalSecs = m.steps.reduce((a,s)=>a+s.secs,0);
      $('#missionTitle').textContent = m.title;
      $('#missionDesc').textContent = m.desc;
      $('#stepText').textContent = m.steps[0].label;
      $('#time').textContent = fmt(stepRemain);
      $('#bar').style.width = '0%';
      $('#missionModal').showModal();
    }

    function fmt(s){ const m = Math.floor(s/60); const r = s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }

    function startMission(){
      ensureAudio();
      clearInterval(timerInt); tone(740,.12);
      timerInt = setInterval(()=>{
        tick();
        if(stepRemain>0){
          stepRemain--; elapsed++;
          $('#time').textContent = fmt(stepRemain);
          $('#bar').style.width = (elapsed/totalSecs*100)+'%';
        }
        if(stepRemain===0){
          const m = missions[currentMission];
          if(stepIdx < m.steps.length-1){
            stepIdx++; stepRemain = m.steps[stepIdx].secs; $('#stepText').textContent = m.steps[stepIdx].label; tone(600,.1);
          } else {
            finishMission();
          }
        }
      }, 1000);
    }

    function pauseMission(){ clearInterval(timerInt); tone(420,.08) }

    function finishMission(){
      clearInterval(timerInt);
      const m = missions[currentMission];
      if(!state.doneToday[currentMission]){
        addStars(m.points);
        state.doneToday[currentMission] = true;
        if(Object.keys(state.doneToday).length===1) state.badges.add('Dia Iniciado ‚ú®');
      } else {
        addStars(1);
      }
      addFlower();
      save();
      $('#missionModal').close();
    }

    // Bot√µes modal
    $('#startBtn').addEventListener('click', startMission);
    $('#pauseBtn').addEventListener('click', pauseMission);
    $('#finishBtn').addEventListener('click', finishMission);
    $('#closeBtn').addEventListener('click', ()=>{ pauseMission(); $('#missionModal').close(); });

    // Abrir miss√µes
    $$('.btn[data-mission]').forEach(btn=> btn.addEventListener('click', ()=>{
      const key = btn.getAttribute('data-mission');
      if(key==='agua' || key==='contato'){
        ensureAudio(); addStars(missions[key].points); state.doneToday[key] = true; addFlower(); setAffirm(); save();
      } else {
        openMission(key);
      }
    }));

    // ========= Mudo & Noturno =========
    $('#muteBtn').addEventListener('click', ()=>{
      state.muted = !state.muted;
      $('#muteBtn').textContent = state.muted? 'üîá Sem som' : 'üîà Som';
      $('#muteBtn').setAttribute('aria-pressed', String(state.muted));
      if(!state.muted) ensureAudio();
      save();
    });

    $('#nightBtn').addEventListener('click', ()=>{
      state.night = !state.night;
      document.body.classList.toggle('dark', state.night);
      $('#nightBtn').textContent = state.night? 'üåô Modo Noturno: ON' : 'üåô Modo Noturno: OFF';
      $('#nightBtn').setAttribute('aria-pressed', String(state.night));
      save();
    });

    // ========= Init =========
    load();
    updateUI();

    // Tornar √°udio dispon√≠vel ap√≥s qualquer intera√ß√£o (exig√™ncia dos browsers)
    document.addEventListener('click', ()=>ensureAudio(), {once:true});

    // Reposicionar flores ao redimensionar mantendo %
    window.addEventListener('resize', renderGarden);

    // Mensagem inicial suave (uma vez)
    if(!localStorage.getItem('jardim-julia-welcome')){
      alert('Bem-vinda, J√∫lia! Cada miss√£o conclu√≠da planta uma flor no jardim. Vamos come√ßar com uma microa√ß√£o? üåº');
      localStorage.setItem('jardim-julia-welcome','1');
    }

    // CTA inline do CVV acess√≠vel por teclado (foco/enter)
    $('#cvvCtaInline')?.addEventListener('click', ()=>{ window.location.href = 'tel:188'; });
  </script>
</body>
</html>

